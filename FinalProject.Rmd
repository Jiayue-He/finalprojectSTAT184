---
title: "Final Project"
author: Jiayue He & Xuefei Wang
output: html_notebook
---

#Step 1:Download packages
```{r}  
library(mosaic)
library(DataComputing)
library(tidyverse)
library(mosaicData)
library(dplyr)
library("rjson")
library(lubridate)
library(party)
```


#Step 2:Importing and preparing data 
```{r}
Canada <- read.csv("CAvideos.csv")
US <- read.csv("USvideos.csv")
GreatBritain <- read.csv("GB.csv")
```

```{r}
CategoryID <- fromJSON(file = "CA_category_id.json")
list <- CategoryID[["items"]]
items <- length(list)
ids <- numeric(items)
for(i in 1 : 31) {
  ids[i] <- CategoryID[["items"]][[i]][[3]]
}

names <- character(items)
for(i in 1 : 31) {
  names[i] <- CategoryID[["items"]][[i]][[4]][[2]]
}

names <- c('Film & Animation', 'Autos & Vehicles', 'Music', 'Pets & Animals', 'Sports', 
           'Short Movies', 'Travel & Events', 'Gaming', 'Videoblogging', 'People & Blogs', 
           'Comedy', 'Entertainment', 'News & Politics', 'How to & Style', 'Education', 
           'Science & Technology', 'Nonprofits & Activism', 'Movies', 'Anime/Animation', 
           'Action/Adventure', 'Classics', 'Comedy2', 'Documentary', 'Drama', 'Family', 
           'Foreign', 'Horror', 'Sci-Fi/Fantasy', 'Thriller', 'Shorts', 'Shows')

Canada$categories <- factor(Canada$category_id, levels = ids, labels = names)
US$categories <- factor(US$category_id, levels = ids, labels = names)
GreatBritain$categories <- factor(GreatBritain$category_id, levels = ids, labels = names)
```


#Step 3:Look at the datatable by using summary functions
```{r}
head(Canada)
tail(US)
names(GreatBritain)
```



#Step 4: Clean Tables
```{r}
Canada <- #filter NA
  Canada %>%
  filter(categories != " ")

US <-
  US %>%
  filter(categories != " ")

GreatBritain <-
  GreatBritain %>%
  filter(categories != " ")
```

```{r}
Canada <-
  Canada %>%
  filter(grepl("^2017-11+", publish_time, ignore.case = TRUE))

US <-
  US %>%
  filter(grepl("^2017-11+", publish_time, ignore.case = TRUE))

GreatBritain <-
  GreatBritain %>%
  filter(grepl("^2017-11+", publish_time, ignore.case = TRUE))

```


```{r}
Canada <-
  Canada %>%
  mutate(publish_time = as.POSIXct(Canada$publish_time))
US <-
  US %>%
  mutate(publish_time = as.POSIXct(US$publish_time))
GreatBritain <-
  GreatBritain %>%
  mutate(publish_time = as.POSIXct(GreatBritain$publish_time))
```


#Step 5:Data Wrangling 
```{r}
Canada <-
  Canada %>%
  select(title, publish_time, channel_title, categories, publish_time, tags, views, likes, dislikes, comment_count, thumbnail_link, description)

US <-
  US %>%
  select(title, publish_time, channel_title, categories, publish_time, tags, views, likes, dislikes, comment_count, thumbnail_link, description)

GreatBritain <-
  GreatBritain %>%
  select(title, publish_time, channel_title, categories, publish_time, tags, views, likes, dislikes, comment_count, thumbnail_link, description)
```

 
 
```{r}
View(Canada) 
View(US)
View(GreatBritain)
```


#Step 6:Combine all the data
```{r}
All <-
  rbind(US,Canada,GreatBritain)
```

```{r}
view(All)
```

```{r}
USC <-
  US %>%
  mutate(view = views/10000)
```


#Step 7: Visualization
```{r}
USC %>%
  ggplot(aes(x = reorder(categories, -view), y = view, fill = categories)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  labs(y = "views in k")
```

```{r}
USD <-
  US %>%
  mutate(view = views/10000) %>%
  filter(categories != "Music")
```
```{r}
USD %>%
  ggplot() +
  geom_bar(aes(x = reorder(categories, -view), y = view, fill = categories), stat = "identity") +
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) + 
  labs(y = "views in k")
```  


##:Engagement

```{r}
glimpse(All)
```

```{r}
engagement<-
  All %>%
  group_by(categories) %>%
  mutate(engage = as.numeric(likes) + as.numeric(dislikes)+ as.numeric(comment_count)) %>%
  summarise(total = sum(engage,na.rm=TRUE)) %>%
  arrange(desc(total))

engagement
```

```{r}
percentage <-
  All %>%
  mutate(engage = as.numeric(likes) + as.numeric(dislikes)+ as.numeric(comment_count), "dislikep" = ((as.numeric(dislikes)/engage)*100), "likep" = ((as.numeric(likes)/engage)*100), "commentp" = ((as.numeric(comment_count)/engage)*100)) %>%
  select(publish_time, dislikep, likep, commentp) %>%
  arrange(desc(dislikep))
```

```{r}
plot<-
  percentage%>%
  gather(key=dislikes1, value=per_engage, dislikep, likep, commentp)
```

```{r}
plot %>%
  ggplot(aes(publish_time, per_engage, color = dislikes1)) +
  geom_point(alpha = 0.9) +
  theme(legend.position = "none")
```






























