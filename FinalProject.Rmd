---
title: "Final Project"
author: Jiayue He & Xuefei Wang
output: html_notebook
---

#Step 1:Load packages
```{r}  
rm(list = ls())
```
```{r}
library(mosaic)
library(DataComputing)
library(tidyverse)
library(mosaicData)
library(dplyr)
library("rjson")
library(ggplot2)
library(lubridate)
library(party)

```


#Step 2:Importing and preparing data 
```{r}
Canada <- read.csv("CAvideos.csv")
US <- read.csv("USvideos.csv")
GreatBritain <- read.csv("GB.csv")
```

```{r}
CategoryID <- fromJSON(file = "CA_category_id.json")
list <- CategoryID[["items"]]
items <- length(list)
ids <- numeric(items)
for(i in 1 : 31) {
  ids[i] <- CategoryID[["items"]][[i]][[3]]
}

names <- character(items)
for(i in 1 : 31) {
  names[i] <- CategoryID[["items"]][[i]][[4]][[2]]
}

names <- c('Film & Animation', 'Autos & Vehicles', 'Music', 'Pets & Animals', 'Sports', 
           'Short Movies', 'Travel & Events', 'Gaming', 'Videoblogging', 'People & Blogs', 
           'Comedy', 'Entertainment', 'News & Politics', 'How to & Style', 'Education', 
           'Science & Technology', 'Nonprofits & Activism', 'Movies', 'Anime/Animation', 
           'Action/Adventure', 'Classics', 'Comedy2', 'Documentary', 'Drama', 'Family', 
           'Foreign', 'Horror', 'Sci-Fi/Fantasy', 'Thriller', 'Shorts', 'Shows')

Canada$categories <- factor(Canada$category_id, levels = ids, labels = names)
US$categories <- factor(US$category_id, levels = ids, labels = names)
GreatBritain$categories <- factor(GreatBritain$category_id, levels = ids, labels = names)
```


#Step 3:Look at the datatable by using summary functions
```{r}
head(Canada)
tail(US)
names(GreatBritain)
```



#Step 4: Clean Tables
```{r}
Canada <- #filter NA
  Canada %>%
  filter(categories != " ")

US <-
  US %>%
  filter(categories != " ")

GreatBritain <-
  GreatBritain %>%
  filter(categories != " ")
```

```{r}
Canada <-
  Canada %>%
  filter(grepl("^2017-11+", publish_time, ignore.case = TRUE))

US <-
  US %>% 
  filter(grepl("^2017-11+", publish_time, ignore.case = TRUE))

GreatBritain <-
  GreatBritain %>%
  filter(grepl("^2017-11+", publish_time, ignore.case = TRUE))

```


```{r}
Canada <-
  Canada %>%
  mutate(publish_time = as.POSIXct(Canada$publish_time))
US <-
  US %>%
  mutate(publish_time = as.POSIXct(US$publish_time))
GreatBritain <-
  GreatBritain %>%
  mutate(publish_time = as.POSIXct(GreatBritain$publish_time))
```


#Step 5:Data Wrangling 
```{r}
Canada <-
  Canada %>%
  select(title, publish_time, channel_title, categories, publish_time, tags, views, likes, dislikes, comment_count, thumbnail_link, description)

US <-
  US %>%
  select(title, publish_time, channel_title, categories, publish_time, tags, views, likes, dislikes, comment_count, thumbnail_link, description)

GreatBritain <-
  GreatBritain %>%
  select(title, publish_time, channel_title, categories, publish_time, tags, views, likes, dislikes, comment_count, thumbnail_link, description)
```

 
 
```{r}
View(Canada) 
View(US)
View(GreatBritain)
```

#Step 6: Visualization

```{r}
US <-
  US %>%
  mutate(view = views/1000)
```

```{r}
US %>%
  ggplot(aes(x = reorder(categories, -view), y = view, fill = categories)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  labs(y = "views in k", x = "category")
```

```{r}
US1 <-
  US %>%
  filter(categories != "Music") %>%
  filter(categories != "Entertainment")
```

```{r}
US1 %>%
  ggplot() +
  geom_bar(aes(x = reorder(categories, -view), y = view, fill = categories), stat = "identity") +
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) + 
  labs(y = "views in k", x = "category")
```  


```{r}
Canada1 <-
  Canada %>%
  filter(categories != "Music") %>%
  filter(categories != "Entertainment") %>%
  mutate(view = views/1000)
```


```{r}
Canada1 %>%
  mutate(like = likes/100) %>%
  ggplot(aes(x=view, y=categories, color = categories, size = like)) +
  geom_point() +
  scale_size(range = c(.1, 10), name="like in hundred")
  labs(x = "view in k", y = "category")
```


```{r}  
GreatBritain <-
  GreatBritain %>%
  filter(categories != "Music") %>%
  filter(categories != "Entertainment") %>%
  arrange(desc(views)) %>%
  head(120)
``` 


```{r}
GreatBritain1 <-
  GreatBritain %>%
  mutate(view = views/1000)
```

```{r}
GreatBritain1 %>%
  ggplot(aes(y = view, x = categories)) +
  geom_boxplot(aes(color = categories, fill = categories),alpha = 0.25, outlier.size = 2, outlier.colour = "black") +
  ylim(0, 13000) +
  labs(x = "category", y = "view in k")+
  theme(legend.position = "bottom") + 
  theme(axis.text.x = element_text(angle = 30, hjust = 1))
```
```{r}
All0 <-
  rbind(US1, Canada1, GreatBritain1)
```

```{r}
View(All0)
```

```{r}
All0 <-
  All0 %>%
  filter(as.numeric(likes) > 100)
```

```{r}
avgAll <-
  All0 %>%
  group_by(categories, view, like, dislikes, comment_count) %>%
  summarise(avgview = mean(view, na.rm = TRUE))
```

```{r}
avgAll %>%
  ggplot(aes(x = categories, y = avgview)) +
  geom_bar(aes(color = categories, fill = categories), stat = "identity")+
  geom_point(data =US1, aes(x= categories, y= likes)) + 
  geom_line(data = Canada1, aes(x = categories, y = likes)) +
  ylim(0, 320000)+
  theme(axis.text.x = element_text(angle = 30, hjust=1))
```


